/*! npm_api_test 2015-06-29 */
var myApp=angular.module("myApp",["angular-loading-bar"]);myApp.controller("GetApi",["$scope","$http",function(a,b){a.clickCounter=0,a.item={},a.sizedArray=[];var c,d,e=function(a){return 2*a.num_favorers+a.views},f=function(a){var b=a.length,c=[],d=[],e=[];for(a.sort(function(a,b){return a.popularity-b.popularity});a.length>b/2;)c.push(a.shift());for(b=a.length;a.length>b/2;)d.push(a.shift());for(b=a.length;a.length>b/3;)e.push(a.shift());for(i=0;i<c.length;i++)c[i]["class"]="",c[i].banner="../images/blank.png",c[i].fade="rgba(255, 255, 255, 0.6)";for(i=0;i<d.length;i++)d[i]["class"]="size2",d[i].banner="../images/blue-corner-banner.png",d[i].fade="transparent";for(i=0;i<e.length;i++)e[i]["class"]="size3",e[i].banner="../images/orange-corner-banner.png",e[i].fade="transparent";for(i=0;i<a.length;i++)a[i]["class"]="size4",a[i].banner="../images/red-corner-banner.png",a[i].fade="transparent";for(;c.length>0;)a.push(c.shift());for(;d.length>0;)a.push(d.shift());for(;e.length>0;)a.push(e.shift());return a.sort(function(a,b){return a.id-b.id}),a},g=function(){for(var b=0;b<a.listings.length;b++)a.item.id=b+1,a.item.image=a.listings[b].Images[0].url_170x135,a.item.popularity=e(a.listings[b]),a.item.url=a.listings[b].url,a.sizedArray.push(a.item),a.item={};c=Math.max.apply(Math,a.sizedArray.map(function(a){return a.popularity})),d=Math.min.apply(Math,a.sizedArray.map(function(a){return a.popularity})),f(a.sizedArray)},h=function(a){console.log("item count: ",a.count),console.log("items per page: ",a.pagination.effective_limit),console.log("number of pages: ",Math.round(a.count/a.pagination.effective_limit))};a.displayListings=function(){return a.clickCounter++,a.sizedArray=[],a.loading=!0,b.get("/etsy",function(){cfpLoadingBar.start()}).then(function(b){return 200!==b.status&&console.log("Response Error, cannot reach data"),a.listings=b.data.results,g(),h(b.data),b.data})["finally"](function(){a.loading=!1,cfpLoadingBar.complete()})}}]);